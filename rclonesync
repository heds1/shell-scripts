#!/bin/bash
# run rclone sync to backup user files.
# currently lives in $HOME/.local/bin
# usage: $ rclonesync
#
# opts:
#   -t
#       test: run rclone sync as a --dry-run, i.e.,
#       don't make changes but see what would happen
#  -d
#       download changes from remote, rather than
#       upload changes (which is default)

# define logfile
log_file=~/synclog.txt

# define target subdirectories to be synced
#target_dirs=('finance') # for dev only
target_dirs=('employment' 'finance' 'pics' 'notes' 'personal')

# explicity define vars in this env
dry_run=false
download=false

# get options
while getopts ":td" opt; do
    case $opt in
        d) download=true                          ;;
        t) dry_run=true                           ;;
        \?) echo "Invalid option: -$OPTARG" >&2   ;;
    esac
done

# define source and remote destinations
if [ "$download" = true ] ; then
    echo Downloading files...
    source_dir=remote:
    dest_dir=~/docs/
else
    echo Uploading files...
    source_dir=~/docs/
    dest_dir=remote:
fi

for folder in "${target_dirs[@]}"
    do
        sync_status="Syncing $folder folder"
        if [ "$dry_run" = true ] ; then
            sync_status="$sync_status as a dry run"
            echo $sync_status
            rclone sync $source_dir$folder $dest_dir$folder -v --dry-run 2>&1 | tee -a ${log_file}
        else
            echo $sync_status
            rclone sync $source_dir$folder $dest_dir$folder -v 2>&1 | tee -a ${log_file}
        fi
    done
